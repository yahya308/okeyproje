<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>101 Okey AI Yardımcı Bot</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .game-board {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .panel h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .okey-indicator {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            color: white;
            text-align: center;
        }

        .okey-indicator h3 {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .indicator-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .indicator-btn {
            padding: 8px 12px;
            border: 2px solid white;
            border-radius: 8px;
            background: rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }

        .indicator-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .indicator-btn.selected {
            background: white;
            color: #ff6b6b;
        }

        .tile-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .color-section {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .color-label {
            font-weight: bold;
            text-align: center;
            padding: 5px;
            border-radius: 5px;
            color: white;
            font-size: 0.9rem;
        }

        .kirmizi { background: #e53e3e; }
        .sari { background: #d69e2e; }
        .mavi { background: #3182ce; }
        .siyah { background: #2d3748; }

        .number-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 3px;
        }

        .number-btn {
            padding: 8px;
            border: none;
            border-radius: 5px;
            background: #f7fafc;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .number-btn:hover {
            background: #e2e8f0;
            transform: scale(1.05);
        }

        .number-btn.selected {
            background: #4299e1;
            color: white;
        }

        .okey-section {
            grid-column: span 4;
            margin-top: 10px;
        }

        .okey-btn {
            width: 100%;
            padding: 10px;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }

        .okey-btn:hover {
            transform: scale(1.02);
        }

        .okey-btn.selected {
            background: linear-gradient(45deg, #ee5a52, #feca57);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .player-hand {
            min-height: 200px;
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            padding: 15px;
            background: #f7fafc;
        }

        .selected-tiles {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            min-height: 60px;
        }

        .tile {
            display: inline-flex;
            align-items: center;
            padding: 8px 12px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .tile:hover {
            transform: scale(1.05);
        }

        .tile .remove {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e53e3e;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            flex: 1;
        }

        .btn-primary {
            background: #4299e1;
            color: white;
        }

        .btn-primary:hover {
            background: #3182ce;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn-warning:hover {
            background: #dd6b20;
            transform: translateY(-2px);
        }

        .discarded-tiles {
            min-height: 100px;
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            padding: 15px;
            background: #f7fafc;
        }

        .results {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-top: 20px;
        }

        .result-section {
            margin-bottom: 25px;
        }

        .result-section h3 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .per-display {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .per-group {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 10px;
            background: #f7fafc;
        }

        .per-group h4 {
            margin-bottom: 8px;
            color: #4a5568;
        }

        .recommendation {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid;
        }

        .recommendation.success {
            background: #f0fff4;
            border-left-color: #48bb78;
            color: #22543d;
        }

        .recommendation.warning {
            background: #fffbeb;
            border-left-color: #ed8936;
            color: #744210;
        }

        .recommendation.info {
            background: #ebf8ff;
            border-left-color: #4299e1;
            color: #2a4365;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #4a5568;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4299e1;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4299e1;
        }

        .stat-label {
            color: #4a5568;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .quick-add-section {
            margin: 15px 0;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .quick-add-section h4 {
            margin-bottom: 10px;
            color: #4a5568;
            font-size: 1rem;
        }

        .quick-add-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .help-text {
            font-size: 0.85rem;
            color: #718096;
            margin: 0;
            padding: 8px;
            background: #edf2f7;
            border-radius: 5px;
            border-left: 3px solid #4299e1;
        }

        .discarded-tile {
            position: relative;
        }

        .discarded-tile .remove {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e53e3e;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .discarded-tile .remove:hover {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .game-board {
                grid-template-columns: 1fr;
            }
            
            .tile-selector {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }

        .dark-mode {
            background: #181a1b !important;
            color: #e0e0e0 !important;
        }
        .dark-mode .panel {
            background: #23272a !important;
            color: #e0e0e0 !important;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .dark-mode .header {
            color: #fff !important;
        }
        .dark-mode .analysis-section, .dark-mode .per-item, .dark-mode .move-item, .dark-mode .value-item, .dark-mode .risk-item {
            background: #23272a !important;
            color: #e0e0e0 !important;
            border-color: #333 !important;
        }
        .dark-mode .tile-display, .dark-mode .tile-display.large {
            background: #444 !important;
            color: #fff !important;
        }
        .dark-mode .suggested-tile {
            background: #2d3748 !important;
            border-color: #4299e1 !important;
        }
        .dark-mode .score-info {
            background: #23272a !important;
            color: #e0e0e0 !important;
        }
        .dark-mode .results {
            background: #181a1b !important;
            color: #e0e0e0 !important;
        }
        .dark-mode .quick-add-btn, .dark-mode .action-btn {
            background: #23272a !important;
            color: #e0e0e0 !important;
            border: 1px solid #444 !important;
        }
        .dark-mode .color-btn.red { background: #a83232 !important; }
        .dark-mode .color-btn.yellow { background: #bfa52a !important; }
        .dark-mode .color-btn.blue { background: #2255a8 !important; }
        .dark-mode .color-btn.black { background: #111 !important; }
        .dark-mode .okey-indicator { background: #23272a !important; border-color: #444 !important; color: #fff !important; }
        .dark-mode .tile { background: #444 !important; color: #fff !important; }
        .dark-mode .remove { background: #333 !important; color: #fff !important; }

        .dark-mode-toggle {
            position: fixed;
            top: 24px;
            right: 32px;
            z-index: 1000;
            background: #23272a;
            color: #fff;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: background 0.2s;
        }
        .dark-mode-toggle:hover {
            background: #444;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-chess-board"></i> 101 Okey AI Yardımcı Bot</h1>
            <p>Yapay zeka destekli okey strateji asistanı</p>
        </div>

        <!-- Sağ üstte dark mode butonu -->
        <div class="dark-mode-toggle" id="darkModeToggle" title="Karanlık Modu Aç/Kapat">
            <span id="darkModeIcon">🌙</span>
        </div>

        <div class="game-board">
            <!-- Sol Panel: Taş Seçimi -->
            <div class="panel">
                <h2><i class="fas fa-hand-paper"></i> Taşlarınızı Seçin</h2>
                
                <!-- Okey Gösterge Seçimi -->
                <div class="okey-indicator">
                    <h3><i class="fas fa-star"></i> Okey Gösterge Taşı</h3>
                    <p>Bu elde hangi taşın okey olduğunu seçin:</p>
                    <div class="indicator-selector" id="indicatorSelector">
                        <!-- Gösterge butonları JavaScript ile oluşturulacak -->
                    </div>
                </div>
                
                <div class="tile-selector">
                    <!-- Kırmızı -->
                    <div class="color-section">
                        <div class="color-label kirmizi">Kırmızı</div>
                        <div class="number-buttons">
                            <button class="number-btn" data-color="kirmizi" data-number="1">1</button>
                            <button class="number-btn" data-color="kirmizi" data-number="2">2</button>
                            <button class="number-btn" data-color="kirmizi" data-number="3">3</button>
                            <button class="number-btn" data-color="kirmizi" data-number="4">4</button>
                            <button class="number-btn" data-color="kirmizi" data-number="5">5</button>
                            <button class="number-btn" data-color="kirmizi" data-number="6">6</button>
                            <button class="number-btn" data-color="kirmizi" data-number="7">7</button>
                            <button class="number-btn" data-color="kirmizi" data-number="8">8</button>
                            <button class="number-btn" data-color="kirmizi" data-number="9">9</button>
                            <button class="number-btn" data-color="kirmizi" data-number="10">10</button>
                            <button class="number-btn" data-color="kirmizi" data-number="11">11</button>
                            <button class="number-btn" data-color="kirmizi" data-number="12">12</button>
                            <button class="number-btn" data-color="kirmizi" data-number="13">13</button>
                        </div>
                    </div>

                    <!-- Sarı -->
                    <div class="color-section">
                        <div class="color-label sari">Sarı</div>
                        <div class="number-buttons">
                            <button class="number-btn" data-color="sari" data-number="1">1</button>
                            <button class="number-btn" data-color="sari" data-number="2">2</button>
                            <button class="number-btn" data-color="sari" data-number="3">3</button>
                            <button class="number-btn" data-color="sari" data-number="4">4</button>
                            <button class="number-btn" data-color="sari" data-number="5">5</button>
                            <button class="number-btn" data-color="sari" data-number="6">6</button>
                            <button class="number-btn" data-color="sari" data-number="7">7</button>
                            <button class="number-btn" data-color="sari" data-number="8">8</button>
                            <button class="number-btn" data-color="sari" data-number="9">9</button>
                            <button class="number-btn" data-color="sari" data-number="10">10</button>
                            <button class="number-btn" data-color="sari" data-number="11">11</button>
                            <button class="number-btn" data-color="sari" data-number="12">12</button>
                            <button class="number-btn" data-color="sari" data-number="13">13</button>
                        </div>
                    </div>

                    <!-- Mavi -->
                    <div class="color-section">
                        <div class="color-label mavi">Mavi</div>
                        <div class="number-buttons">
                            <button class="number-btn" data-color="mavi" data-number="1">1</button>
                            <button class="number-btn" data-color="mavi" data-number="2">2</button>
                            <button class="number-btn" data-color="mavi" data-number="3">3</button>
                            <button class="number-btn" data-color="mavi" data-number="4">4</button>
                            <button class="number-btn" data-color="mavi" data-number="5">5</button>
                            <button class="number-btn" data-color="mavi" data-number="6">6</button>
                            <button class="number-btn" data-color="mavi" data-number="7">7</button>
                            <button class="number-btn" data-color="mavi" data-number="8">8</button>
                            <button class="number-btn" data-color="mavi" data-number="9">9</button>
                            <button class="number-btn" data-color="mavi" data-number="10">10</button>
                            <button class="number-btn" data-color="mavi" data-number="11">11</button>
                            <button class="number-btn" data-color="mavi" data-number="12">12</button>
                            <button class="number-btn" data-color="mavi" data-number="13">13</button>
                        </div>
                    </div>

                    <!-- Siyah -->
                    <div class="color-section">
                        <div class="color-label siyah">Siyah</div>
                        <div class="number-buttons">
                            <button class="number-btn" data-color="siyah" data-number="1">1</button>
                            <button class="number-btn" data-color="siyah" data-number="2">2</button>
                            <button class="number-btn" data-color="siyah" data-number="3">3</button>
                            <button class="number-btn" data-color="siyah" data-number="4">4</button>
                            <button class="number-btn" data-color="siyah" data-number="5">5</button>
                            <button class="number-btn" data-color="siyah" data-number="6">6</button>
                            <button class="number-btn" data-color="siyah" data-number="7">7</button>
                            <button class="number-btn" data-color="siyah" data-number="8">8</button>
                            <button class="number-btn" data-color="siyah" data-number="9">9</button>
                            <button class="number-btn" data-color="siyah" data-number="10">10</button>
                            <button class="number-btn" data-color="siyah" data-number="11">11</button>
                            <button class="number-btn" data-color="siyah" data-number="12">12</button>
                            <button class="number-btn" data-color="siyah" data-number="13">13</button>
                        </div>
                    </div>

                    <!-- Sahte Okey -->
                    <div class="okey-section">
                        <button class="okey-btn" data-color="sahte_okey" data-number="0">
                            <i class="fas fa-star"></i> Sahte Okey
                        </button>
                    </div>
                </div>

                <div class="player-hand">
                    <h3>Seçilen Taşlarınız:</h3>
                    <div class="selected-tiles" id="selectedTiles"></div>
                    <div class="controls">
                        <button class="btn btn-warning" onclick="clearSelection()">
                            <i class="fas fa-trash"></i> Temizle
                        </button>
                        <button class="btn btn-primary" onclick="analyzeHand()">
                            <i class="fas fa-brain"></i> Analiz Et
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sağ Panel: Atılan Taşlar -->
            <div class="panel">
                <h2><i class="fas fa-trash-alt"></i> Atılan Taşlar</h2>
                
                <div class="discarded-tiles">
                    <h3>Diğer Oyuncuların Attığı Taşlar:</h3>
                    <div class="selected-tiles" id="discardedTiles"></div>
                    
                    <!-- Hızlı Taş Ekleme -->
                    <div class="quick-add-section">
                        <h4>Hızlı Taş Ekleme:</h4>
                        <div class="quick-add-buttons">
                            <button class="btn btn-primary" onclick="addCommonDiscarded()">
                                <i class="fas fa-plus"></i> Yaygın Taşlar
                            </button>
                            <button class="btn btn-warning" onclick="clearDiscarded()">
                                <i class="fas fa-trash"></i> Temizle
                            </button>
                        </div>
                        <p class="help-text">
                            <i class="fas fa-info-circle"></i> 
                            Taş eklemek için: <strong>Sağ tık</strong> veya <strong>Çift tık</strong> yapın
                        </p>
                    </div>
                    
                    <div class="controls">
                        <button class="btn btn-success" onclick="suggestTile()">
                            <i class="fas fa-lightbulb"></i> Taş Öner
                        </button>
                        <button class="btn btn-primary" onclick="runSimulation()">
                            <i class="fas fa-dice"></i> Simülasyon
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sonuçlar -->
        <div class="results" id="results" style="display: none;">
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>AI analiz yapıyor...</p>
            </div>
            
            <div id="analysisResults" style="display: none;">
                <!-- Analiz sonuçları buraya gelecek -->
            </div>
        </div>
    </div>

    <script>
        let selectedTiles = [];
        let discardedTiles = [];
        let selectedIndicator = null;

        // Gösterge butonlarını oluştur
        function createIndicatorButtons() {
            const container = document.getElementById('indicatorSelector');
            const colors = ['kirmizi', 'sari', 'mavi', 'siyah'];
            const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13];
            
            colors.forEach(color => {
                numbers.forEach(number => {
                    const btn = document.createElement('button');
                    btn.className = 'indicator-btn';
                    btn.textContent = `${color.charAt(0).toUpperCase()}${color.slice(1)} ${number}`;
                    btn.dataset.color = color;
                    btn.dataset.number = number;
                    
                    btn.addEventListener('click', function() {
                        // Önceki seçimi kaldır
                        document.querySelectorAll('.indicator-btn').forEach(b => b.classList.remove('selected'));
                        this.classList.add('selected');
                        selectedIndicator = { color, number };
                    });
                    
                    container.appendChild(btn);
                });
            });
        }

        // Sayfa yüklendiğinde gösterge butonlarını oluştur
        document.addEventListener('DOMContentLoaded', createIndicatorButtons);

        // Taş seçimi
        document.querySelectorAll('.number-btn, .okey-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const color = this.dataset.color;
                const number = parseInt(this.dataset.number);
                
                // Aynı taş zaten seçili mi kontrol et
                const existingTile = selectedTiles.find(tile => 
                    tile.color === color && tile.number === number
                );
                
                if (existingTile) {
                    // Taşı kaldır
                    selectedTiles = selectedTiles.filter(tile => tile !== existingTile);
                    this.classList.remove('selected');
                } else {
                    // Taşı ekle
                    selectedTiles.push({ color, number });
                    this.classList.add('selected');
                }
                
                updateSelectedTilesDisplay();
            });
        });

        function updateSelectedTilesDisplay() {
            const container = document.getElementById('selectedTiles');
            container.innerHTML = '';
            
            selectedTiles.forEach(tile => {
                const tileElement = createTileElement(tile, true);
                container.appendChild(tileElement);
            });
        }

        function updateDiscardedTilesDisplay() {
            const container = document.getElementById('discardedTiles');
            container.innerHTML = '';
            
            discardedTiles.forEach(tile => {
                const tileElement = createDiscardedTileElement(tile);
                container.appendChild(tileElement);
            });
        }

        function createDiscardedTileElement(tile) {
            const div = document.createElement('div');
            div.className = 'tile discarded-tile';
            
            let backgroundColor = '#4a5568';
            if (tile.color === 'kirmizi') backgroundColor = '#e53e3e';
            else if (tile.color === 'sari') backgroundColor = '#d69e2e';
            else if (tile.color === 'mavi') backgroundColor = '#3182ce';
            else if (tile.color === 'siyah') backgroundColor = '#2d3748';
            else if (tile.color === 'sahte_okey') backgroundColor = 'linear-gradient(45deg, #ff6b6b, #feca57)';
            
            div.style.background = backgroundColor;
            
            if (tile.color === 'sahte_okey') {
                div.innerHTML = `<i class="fas fa-star"></i> Sahte Okey`;
            } else {
                div.innerHTML = `${tile.color.charAt(0).toUpperCase()}${tile.color.slice(1)} ${tile.number}`;
            }
            
            // Kaldırma butonu ekle
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove';
            removeBtn.innerHTML = '×';
            removeBtn.onclick = () => removeDiscardedTile(tile);
            div.appendChild(removeBtn);
            
            return div;
        }

        function createTileElement(tile, isPlayerTile) {
            const div = document.createElement('div');
            div.className = 'tile';
            
            let backgroundColor = '#4a5568';
            if (tile.color === 'kirmizi') backgroundColor = '#e53e3e';
            else if (tile.color === 'sari') backgroundColor = '#d69e2e';
            else if (tile.color === 'mavi') backgroundColor = '#3182ce';
            else if (tile.color === 'siyah') backgroundColor = '#2d3748';
            else if (tile.color === 'sahte_okey') backgroundColor = 'linear-gradient(45deg, #ff6b6b, #feca57)';
            
            div.style.background = backgroundColor;
            
            if (tile.color === 'sahte_okey') {
                div.innerHTML = `<i class="fas fa-star"></i> Sahte Okey`;
            } else {
                div.innerHTML = `${tile.color.charAt(0).toUpperCase()}${tile.color.slice(1)} ${tile.number}`;
            }
            
            if (isPlayerTile) {
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove';
                removeBtn.innerHTML = '×';
                removeBtn.onclick = () => removeTile(tile);
                div.appendChild(removeBtn);
            }
            
            return div;
        }

        function removeTile(tile) {
            selectedTiles = selectedTiles.filter(t => t !== tile);
            updateSelectedTilesDisplay();
            
            // Buton seçimini kaldır
            const btn = document.querySelector(`[data-color="${tile.color}"][data-number="${tile.number}"]`);
            if (btn) btn.classList.remove('selected');
        }

        function clearSelection() {
            selectedTiles = [];
            updateSelectedTilesDisplay();
            document.querySelectorAll('.number-btn, .okey-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
        }

        function clearDiscarded() {
            discardedTiles = [];
            updateDiscardedTilesDisplay();
        }

        // Atılan taşları eklemek için sağ paneldeki taş seçicileri
        document.querySelectorAll('.number-btn, .okey-btn').forEach(btn => {
            btn.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                const color = this.dataset.color;
                const number = parseInt(this.dataset.number);
                
                const tile = { color, number };
                discardedTiles.push(tile);
                updateDiscardedTilesDisplay();
            });
        });

        async function analyzeHand() {
            if (selectedTiles.length === 0) {
                alert('Lütfen en az bir taş seçin!');
                return;
            }

            showLoading();
            
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        player_tiles: selectedTiles,
                        discarded_tiles: discardedTiles,
                        okey_tile: selectedIndicator
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    displayAnalysis(data.analysis);
                } else {
                    alert('Hata: ' + data.error);
                }
            } catch (error) {
                alert('Bağlantı hatası: ' + error.message);
            }
        }

        async function suggestTile() {
            if (selectedTiles.length === 0) {
                alert('Lütfen en az bir taş seçin!');
                return;
            }

            showLoading();
            
            try {
                const response = await fetch('/api/suggest_tile', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        player_tiles: selectedTiles,
                        discarded_tiles: discardedTiles,
                        okey_tile: selectedIndicator
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    displaySuggestion(data.suggestion);
                } else {
                    alert('Hata: ' + data.error);
                }
            } catch (error) {
                alert('Bağlantı hatası: ' + error.message);
            }
        }

        async function runSimulation() {
            if (selectedTiles.length === 0) {
                alert('Lütfen en az bir taş seçin!');
                return;
            }

            showLoading();
            
            try {
                const response = await fetch('/api/simulate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        player_tiles: selectedTiles,
                        discarded_tiles: discardedTiles,
                        okey_tile: selectedIndicator,
                        num_simulations: 100
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    displaySimulation(data.simulation);
                } else {
                    alert('Hata: ' + data.error);
                }
            } catch (error) {
                alert('Bağlantı hatası: ' + error.message);
            }
        }

        function showLoading() {
            document.getElementById('results').style.display = 'block';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('analysisResults').style.display = 'none';
        }

        function displayAnalysis(analysis) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('analysisResults').style.display = 'block';
            
            const container = document.getElementById('analysisResults');
            
            let html = `
                <div class="result-section">
                    <h3><i class="fas fa-chart-line"></i> El Analizi</h3>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-value">${analysis.best_arrangement.score}</div>
                            <div class="stat-label">Toplam Puan</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${analysis.best_arrangement.total_tiles_used}</div>
                            <div class="stat-label">Kullanılan Taş</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${analysis.best_arrangement.pers.length}</div>
                            <div class="stat-label">Oluşturulan Per</div>
                        </div>
                    </div>
                </div>
            `;

            // Per dizilimi
            if (analysis.best_arrangement.pers.length > 0) {
                html += `
                    <div class="result-section">
                        <h3><i class="fas fa-layer-group"></i> En İyi Per Dizilimi</h3>
                        <div class="per-display">
                `;
                
                analysis.best_arrangement.pers.forEach((per, index) => {
                    const perScore = per.reduce((sum, tile) => sum + tile.number, 0);
                    html += `
                        <div class="per-group">
                            <h4>Per ${index + 1} (${perScore} puan)</h4>
                            <div class="per-tiles">
                    `;
                    
                    per.forEach(tile => {
                        html += `<span class="tile" style="background: ${getTileColor(tile.color)}; margin: 2px;">${tile.color} ${tile.number}</span>`;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                });
                
                html += `</div></div>`;
            }

            // Öneriler
            if (analysis.recommendations.length > 0) {
                html += `
                    <div class="result-section">
                        <h3><i class="fas fa-lightbulb"></i> AI Önerileri</h3>
                `;
                
                analysis.recommendations.forEach(rec => {
                    let className = 'info';
                    if (rec.includes('✅')) className = 'success';
                    else if (rec.includes('⚠️')) className = 'warning';
                    
                    html += `<div class="recommendation ${className}">${rec}</div>`;
                });
                
                html += `</div>`;
            }

            container.innerHTML = html;
        }

        function displaySuggestion(suggestion) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('analysisResults').style.display = 'block';
            
            const container = document.getElementById('analysisResults');
            
            const html = `
                <div class="result-section">
                    <h3><i class="fas fa-lightbulb"></i> Taş Önerisi</h3>
                    <div class="recommendation success">
                        <strong>${suggestion.suggestion}</strong><br>
                        <small>${suggestion.reason}</small>
                    </div>
                    ${suggestion.risk_level > 7 ? '<div class="recommendation warning">⚠️ Bu taş yüksek riskli olabilir!</div>' : ''}
                </div>
            `;
            
            container.innerHTML = html;
        }

        function displaySimulation(simulation) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('analysisResults').style.display = 'block';
            
            const container = document.getElementById('analysisResults');
            
            let html = `
                <div class="result-section">
                    <h3><i class="fas fa-dice"></i> Monte Carlo Simülasyon Sonuçları</h3>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-value">${(simulation.win_rate * 100).toFixed(1)}%</div>
                            <div class="stat-label">Kazanma Oranı</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${simulation.avg_score.toFixed(1)}</div>
                            <div class="stat-label">Ortalama Puan</div>
                        </div>
                    </div>
                </div>
            `;

            if (simulation.best_moves.length > 0) {
                html += `
                    <div class="result-section">
                        <h3><i class="fas fa-trophy"></i> En İyi Hamleler</h3>
                `;
                
                simulation.best_moves.slice(0, 5).forEach((move, index) => {
                    html += `
                        <div class="recommendation info">
                            <strong>${index + 1}. ${move.move}</strong><br>
                            Ortalama Puan: ${move.avg_score.toFixed(1)} | 
                            Kazanma Oranı: ${(move.win_rate * 100).toFixed(1)}%
                        </div>
                    `;
                });
                
                html += `</div>`;
            }
            
            container.innerHTML = html;
        }

        function getTileColor(color) {
            switch(color) {
                case 'kirmizi': return '#e53e3e';
                case 'sari': return '#d69e2e';
                case 'mavi': return '#3182ce';
                case 'siyah': return '#2d3748';
                case 'sahte_okey': return 'linear-gradient(45deg, #ff6b6b, #feca57)';
                default: return '#4a5568';
            }
        }

        // Atılan taşları eklemek için daha kullanıcı dostu yöntem
        function addDiscardedTile(color, number) {
            const tile = { color, number };
            discardedTiles.push(tile);
            updateDiscardedTilesDisplay();
        }

        // Atılan taşları kaldırmak için
        function removeDiscardedTile(tile) {
            discardedTiles = discardedTiles.filter(t => t !== tile);
            updateDiscardedTilesDisplay();
        }

        // Sağ tık ile atılan taş ekleme (düzeltilmiş)
        document.addEventListener('contextmenu', function(e) {
            if (e.target.classList.contains('number-btn') || e.target.classList.contains('okey-btn')) {
                e.preventDefault();
                const color = e.target.dataset.color;
                const number = parseInt(e.target.dataset.number);
                
                addDiscardedTile(color, number);
            }
        });

        // Çift tık ile atılan taş ekleme (alternatif yöntem)
        document.addEventListener('dblclick', function(e) {
            if (e.target.classList.contains('number-btn') || e.target.classList.contains('okey-btn')) {
                const color = e.target.dataset.color;
                const number = parseInt(e.target.dataset.number);
                
                addDiscardedTile(color, number);
            }
        });

        function addCommonDiscarded() {
            // Yaygın atılan taşları ekle
            const commonTiles = [
                { color: 'kirmizi', number: 1 },
                { color: 'kirmizi', number: 13 },
                { color: 'sari', number: 1 },
                { color: 'sari', number: 13 },
                { color: 'mavi', number: 1 },
                { color: 'mavi', number: 13 },
                { color: 'siyah', number: 1 },
                { color: 'siyah', number: 13 }
            ];
            
            // Zaten eklenmiş olanları filtrele
            const newTiles = commonTiles.filter(tile => 
                !discardedTiles.some(dt => dt.color === tile.color && dt.number === tile.number)
            );
            
            discardedTiles.push(...newTiles);
            updateDiscardedTilesDisplay();
        }

        // Dark mode toggle
        const darkModeToggle = document.getElementById('darkModeToggle');
        const darkModeIcon = document.getElementById('darkModeIcon');
        function setDarkMode(enabled) {
            if (enabled) {
                document.body.classList.add('dark-mode');
                darkModeIcon.textContent = '☀️';
                localStorage.setItem('darkMode', '1');
            } else {
                document.body.classList.remove('dark-mode');
                darkModeIcon.textContent = '🌙';
                localStorage.setItem('darkMode', '0');
            }
        }
        darkModeToggle.addEventListener('click', () => {
            setDarkMode(!document.body.classList.contains('dark-mode'));
        });
        // Sayfa yüklenince dark mode'u uygula
        if (localStorage.getItem('darkMode') === '1') {
            setDarkMode(true);
        }

        // Simülasyon sonuçlarını yatay kartlar halinde göster
        function formatAnalysisResults(data) {
            let html = '';
            // ... mevcut kod ...
            // Simülasyon sonuçları formatı
            if (data.win_rate !== undefined || data.avg_score !== undefined) {
                html += '<div class="analysis-section">';
                html += '<h4>🎲 Simülasyon Sonuçları</h4>';
                if (data.win_rate !== undefined) {
                    html += `<p><strong>Kazanma Oranı:</strong> ${(data.win_rate * 100).toFixed(1)}%</p>`;
                }
                if (data.avg_score !== undefined) {
                    html += `<p><strong>Ortalama Puan:</strong> ${data.avg_score.toFixed(1)}</p>`;
                }
                if (data.best_moves && data.best_moves.length > 0) {
                    html += '<div class="best-moves-row" style="display: flex; gap: 16px; flex-wrap: wrap; margin-top: 16px;">';
                    data.best_moves.slice(0, 5).forEach((move, index) => {
                        html += `<div class="move-item" style="flex: 1 1 180px; min-width: 180px; max-width: 220px; background: var(--move-bg, #fff); border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.07); padding: 16px; display: flex; flex-direction: column; align-items: center;">
                            <span class="tile-display large" style="margin-bottom: 8px;">${move.move.replace('_', ' ')}</span>
                            <span style="font-size: 1.1rem; font-weight: bold; color: #4299e1;">${move.avg_score.toFixed(1)} puan</span>
                            <span style="font-size: 0.95rem; color: #38a169;">Kazanma: ${(move.win_rate * 100).toFixed(1)}%</span>
                        </div>`;
                    });
                    html += '</div>';
                }
                html += '</div>';
            }
            // ... mevcut kod ...
            return html;
        }
    </script>
</body>
</html> 